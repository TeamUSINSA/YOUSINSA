<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.user.inquiry">

	<select id="selectAll" resultType="dto.user.Inquiry">
		SELECT * FROM inquiry ORDER BY
		question_date DESC
	</select>


	<select id="findAll" resultType="dto.user.Inquiry">
		SELECT * FROM inquiry
	</select>

	<update id="updateInquiryAnswer" parameterType="map">
    UPDATE inquiry
    SET answer = #{answer}, status = #{status}  <!-- ✅ 함께 갱신 -->
    WHERE inquiry_id = #{inquiryId}
</update>

<select id="selectByStatus" parameterType="String" resultType="dto.user.Inquiry">
    SELECT * FROM inquiry
    WHERE status LIKE CONCAT('%', #{status}, '%')
</select>

  <!-- 1) 특정 상품의 문의 목록 조회 -->
<select id="selectByProductId" parameterType="int" resultType="dto.user.Inquiry">
  SELECT
    inquiry_id    AS inquiryId,
    title,
    content,
    image         AS image,        
    answer,
    user_id       AS userId,
    product_id    AS productId,
    question_date AS questionDate,
    status
  FROM inquiry
  WHERE product_id = #{productId}
  ORDER BY question_date DESC
</select>


  <!-- 2) 새 문의 등록 -->
   <insert id="insertInquiry" parameterType="dto.user.Inquiry" useGeneratedKeys="true" keyProperty="inquiryId">
    INSERT INTO inquiry
      (title,
       content,
       image,          
       user_id,
       product_id,
       question_date,
       status)
    VALUES
      (#{title},
       #{content},
       #{image},      
       #{userId},
       #{productId},
       NOW(),
       #{status})
  </insert>
  
</mapper>

