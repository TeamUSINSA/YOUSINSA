<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.cancel">
  
  <!-- 1) 취소/반품 요청 INSERT -->
  <insert id="insertCancel" parameterType="cancel"
          useGeneratedKeys="true" keyProperty="cancelId">
    INSERT INTO cancel
      (user_id, order_id, reason, cancel_date)
    VALUES
      (#{userId}, #{orderId}, #{reason}, NOW())
  </insert>

  <!-- 2) 해당 사용자 취소/반품 내역 전체 조회 -->
  <select id="getCancelsByUserId" parameterType="string" resultType="cancel">
    SELECT
      cancel_id       AS cancelId,
      cancel_date     AS cancelDate,
      reason,
      user_id         AS userId,
      order_id        AS orderId
    FROM cancel
    WHERE user_id = #{userId}
    ORDER BY cancel_date DESC
  </select>

  <!-- 3) 단일 취소/반품 내역 조회 -->
  <select id="getCancelById" parameterType="int" resultType="cancel">
    SELECT
      cancel_id       AS cancelId,
      cancel_date     AS cancelDate,
      reason,
      user_id         AS userId,
      order_id        AS orderId
    FROM cancel
    WHERE cancel_id = #{cancelId}
  </select>

  <!-- 4) 주문별 취소 요청 개수 체크 -->
  <select id="countCancelByOrderId" parameterType="int" resultType="int">
    SELECT COUNT(*)
    FROM cancel
    WHERE order_id = #{orderId}
  </select>

</mapper>
